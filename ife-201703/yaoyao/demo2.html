<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>练习1-表单检验</title>
    <style>
        #main {
            width: 700px;
            margin: 10px auto;
            padding-top: 20px;
            text-align: right;
        }
        input {
            border: 0;
            outline: none;
            width: 600px;
            background-color: #fff;
        }
        .a-input {
            display: inline-block;
            margin-left: 15px;
            padding-left: 10px;
            border: 2px solid grey;
            border-radius: 3px;
            height: 32px;
        }
        .err-mess{
            padding-left: 85px;
            text-align: left;
            line-height: 20px;
        }
        span {
            display: block;
            margin: 7px 0;
            height: 20px;
            color: red;
            font-size: 14px;
            text-align: left;
        }
        p {
            margin: 0;
            line-height: 32px;
        }
        button {
            border: 1px solid #2f64de;
            border-radius: 3px;
            width: 65px;
            height: 28px;
            line-height: 28px;
            background-color: #2F64DE;
            color: #fff;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div id="main">
    <p class="name">
        <label for="name">名称</label>
        <span class="a-input">
            <input type="text" id="name">
        </span>
        <span id="nameTips" class="err-mess"></span>
    </p>
    <p class="passwd">
        <label for="password">密码</label>
        <span class="a-input">
            <input type="password" id="password">
        </span>
        <span id="passTips" class="err-mess"></span>
    </p>
    <p class="repassswd">
        <label for="repassword">确认密码</label>
        <span class="a-input">
            <input type="password" id="repassword">
        </span>
        <span id="repassTips" class="err-mess"></span>
    </p>
    <p class="tel">
        <label for="tel">电话</label>
        <span class="a-input">
            <input type="tel" id="tel" maxlength="11">
        </span>
        <span id="telTips" class="err-mess"></span>
    </p>
    <p class="email">
        <label for="email">邮箱</label>
        <span class="a-input">
            <input type="email" id="email">
        </span>
        <span id="emailTips" class="err-mess"></span>
    </p>
    <button id="btn">提交</button>
</div>
<script>
    var $ = function(id) {
        return document.getElementById(id);
    };

    // 代理
    addEventHandler($('main'), 'focus', checkFocus, true);
    addEventHandler($('main'), 'blur', checkBlur, true);

    $('btn').onclick = function() {
        checkName($('name'));
        checkPass($('password'));
        checkRePass($('repassword'));
        checkTel($('tel'));
        checkEmail($('email'));
    };

    // 获得焦点(捕获)
    function checkFocus(ev) {
        var e = ev || window.event;
        var t = e.target || e.srcElement;

        if (t.nodeName.toLowerCase() === 'input') {
            t.parentNode.style.border = '2px solid black';
            t.parentNode.nextElementSibling.style.color = 'grey';

            switch (t.id) {
                case 'name':
                    t.parentNode.nextElementSibling.innerHTML = '长度需为4-16!';
                    break;

                case 'password':
                    t.parentNode.nextElementSibling.innerHTML = '长度需为8-16!';
                    break;

                case 'repassword':
                    t.parentNode.nextElementSibling.innerHTML = '请保持一致!';
                    break;

                case 'tel':
                    t.parentNode.nextElementSibling.innerHTML = '请输入手机号码!';
                    break;

                default:
                    t.parentNode.nextElementSibling.innerHTML = '请输入邮箱!';
            }
        }
    }

    // 失去焦点
    function checkBlur(ev) {
        var e = ev || window.event;
        var t = e.target || e.srcElement;

        if (t.nodeName.toLowerCase() === 'input') {
            switch (t.id) {
                case 'name':
                    checkName(t);
                    break;

                case 'password':
                    checkPass(t);
                    break;

                case 'repassword':
                    checkRePass(t);
                    break;

                case 'tel':
                    checkTel(t);
                    break;

                default:
                    checkEmail(t);
            }
        }
    }

    // name格式检测
    function checkName(node) {
        if (!node.value) {
            $('nameTips').innerHTML = '输入不能为空!';
            $('nameTips').style.color = '#FC0005';
            node.parentNode.style.border = '2px solid red';
        }
        else if (countLength(node.value) < 4 || countLength(node.value) > 16) {
            $('nameTips').innerHTML = '长度不为4-16!';
            $('nameTips').style.color = '#FC0005';
            node.parentNode.style.border = '2px solid red';
        }
        else {
            $('nameTips').innerHTML = '格式正确!';
        }
    }

    function countLength(str) {
        var count = 0;
        for (var i = 0; i < str.length; i++) {
            var code = str[i].charCodeAt(); // 转换成ASCII
            if (code >=0 && code <= 128) {
                count++;
            }
            else {
                count += 2;
            }
        }
        return count;
    }

    // email格式检测
    function checkEmail(node) {
        if (!node.value) {
            $('emailTips').innerHTML = 'email不能为空!';
            $('emailTips').style.color = 'red';
            node.parentNode.style.border = '2px solid red';
        }
        else if (!/^[\w\d]+@[\w\d]+(\.[\w]{2,3})+$/.test(node.value)) {
            $('emailTips').innerHTML = 'email格式错误!';
            $('emailTips').style.color = 'red';
            node.parentNode.style.border = '2px solid red';
        }
        else {
            $('emailTips').innerHTML = 'email格式正确!';
        }
    }

    // 密码检测
    function checkPass(node) {
        if (!node.value) {
            $('passTips').innerHTML = '密码不能为空!';
            $('passTips').style.color = 'red';
            node.parentNode.style.border = '2px solid red';
        }
        else if (node.value.length > 8 && node.value.length <= 16) {
            $('passTips').innerHTML = '密码格式正确!';
        }
        else {
            $('passTips').innerHTML = '密码长度不合适!';
            $('passTips').style.color = 'red';
            node.parentNode.style.border = '2px solid red';
        }
    }

    // 密码确认
    function checkRePass(node) {
        if (!node.value) {
            $('repassTips').innerHTML = '密码不能为空!';
            $('repassTips').style.color = 'red';
            $('repassword').parentNode.style.border = '2px solid red';
        }
        else if (node.value === $('password').value) {
            $('repassTips').innerHTML = '密码一致!';
        }
        else {
            $('repassTips').innerHTML = '密码不一致!';
            $('repassTips').style.color = 'red';
            $('repassword').parentNode.style.border = '2px solid red';
        }
    }

    // 手机号码检测
    function checkTel(node) {
        if (!node.value) {
            $('telTips').innerHTML = '手机号码不能为空!';
            $('telTips').style.color = 'red';
            node.parentNode.style.border = '2px solid red';
        }
        else if (/^1[3-9]{2}[\d]{8}/.test(node.value)) {
            $('telTips').innerHTML = '手机号码格式正确!';
        }
        else {
            $('telTips').innerHTML = '手机号码格式不正确!';
            $('telTips').style.color = 'red';
            node.parentNode.style.border = '2px solid red';
        }
    }

    function addEventHandler(element, event, listener, capture) {
        capture = capture || false;
        if (element.addEventListener) {
            element.addEventListener(event, listener, capture);
        }
        else if (element.attachEvent) {
            element.attachEvent("on" + event, listener);
        }
        else {
            element['on' + event] = listener;
        }
    }

    // input 失去焦点
    // addEventHandler($('email'), '')
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>练习1-表单检验</title>
    <style>
        .main {
            width: 600px;
            margin: 10px auto;
        }
        span {
            display: block;
            margin: 7px 0;
            height: 20px;
            color: red;
            font-size: 12px;
        }
        p {
            margin: 0;
        }
    </style>
</head>
<body>
<div class="main">
    <p class="name">
        <label for="name">名称:</label>
        <input type="text" id="name">
        <input type="submit" value="submit" id="btn">
    </p>
    <span id="nameTips"></span>
    <p class="email">
        <label for="email">邮箱:</label>
        <input type="email" id="email">
    </p>
    <span id="emailTips"></span>
</div>
<script>
    var $ = function(id) {
        return document.getElementById(id);
    };

    addEventHandler($('email'), 'blur', checkEmail);
    addEventHandler($('btn'), 'click', checkInput); // 判断长度事件

    function checkEmail(ev) {
        $('emailTips').innerHTML = '';
        var e = ev || window.event;
        var value = e.target.value || e.srcElement.value;
        if (!value) {
            $('emailTips').innerHTML = 'email不能为空!';
        }
        else if (!/^[\w\d]+@[\w\d]+(\.[\w]{2,3})+$/.test(value)) {
            $('emailTips').innerHTML = 'email格式错误!';
        }
    }

    function checkInput() {
        $('nameTips').innerHTML = '';
        var value = $('name').value;
        if (!value) {
            $('nameTips').innerHTML = '输入为空!';
        }
        else if (countLength(value) < 4 || countLength(value) > 16) {
            $('nameTips').innerHTML = '字符长度为4-16!';
        }
        else {
            $('nameTips').innerHTML = '格式正确!';
        }
    }

    function countLength(str) {
        var count = 0;
        for (var i = 0; i < str.length; i++) {
            var code = str[i].charCodeAt(); // 转换成ASCII
            if (code >=0 && code <= 128) {
                count++;
            }
            else {
                count += 2;
            }
        }
        return count;
    }

    function addEventHandler(element, event, listener) {
        if (element.addEventListener) {
            element.addEventListener(event, listener, false);
        }
        else if (element.attachEvent) {
            element.attachEvent("on" + event, listener);
        }
        else {
            element['on' + event] = listener;
        }
    }

    // input 失去焦点
    // addEventHandler($('email'), '')
</script>
</body>
</html>
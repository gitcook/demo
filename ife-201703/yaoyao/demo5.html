<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>听指令的小方块-1</title>
    <style>
    svg {
        float:left;
    }
    .btn {
        float:left;
        }
    a {
        display: inline-block;
        width: 60px;
        height: 60px;
        border-radius: 5px;
        background-color: #000;
        color: #fff;
        font: 20px/60px SimHei;
        text-align: center;
        cursor: pointer;
    }
    p {
        text-align:center;
    }
    .box {
        display: inline-block;
        margin-left: 40px;
    }
    </style>
</head>
<body>
<svg xmlns="http://www.w3c.org/2000/svg" width="400" height="400" viewBox="0 0 400 400" preserveAspectRadio="xMidYMid meet">
    <rect x="0" y="0" width="400" height="400" style="stroke: #000;fill: #fff"></rect>

    <!-- 横线 -->
    <line x1="0" y1="40" x2="400" y2="40" style="stroke:#000"></line>
    <line x1="0" y1="80" x2="400" y2="80" style="stroke:#000"></line>
    <line x1="0" y1="120" x2="400" y2="120" style="stroke:#000"></line>
    <line x1="0" y1="160" x2="400" y2="160" style="stroke:#000"></line>
    <line x1="0" y1="200" x2="400" y2="200" style="stroke:#000"></line>
    <line x1="0" y1="240" x2="400" y2="240" style="stroke:#000"></line>
    <line x1="0" y1="280" x2="400" y2="280" style="stroke:#000"></line>
    <line x1="0" y1="320" x2="400" y2="320" style="stroke:#000"></line>
    <line x1="0" y1="360" x2="400" y2="360" style="stroke:#000"></line>
    <line x1="0" y1="400" x2="400" y2="400" style="stroke:#000"></line>

    <!-- 竖线 -->
    <line x1="40" y1="0" x2="40" y2="400" style="stroke: #000"></line>
    <line x1="80" y1="0" x2="80" y2="400" style="stroke: #000"></line>
    <line x1="120" y1="0" x2="120" y2="400" style="stroke: #000"></line>
    <line x1="160" y1="0" x2="160" y2="400" style="stroke: #000"></line>
    <line x1="200" y1="0" x2="200" y2="400" style="stroke: #000"></line>
    <line x1="240" y1="0" x2="240" y2="400" style="stroke: #000"></line>
    <line x1="280" y1="0" x2="280" y2="400" style="stroke: #000"></line>
    <line x1="320" y1="0" x2="320" y2="400" style="stroke: #000"></line>
    <line x1="360" y1="0" x2="360" y2="400" style="stroke: #000"></line>
    <line x1="400" y1="0" x2="400" y2="400" style="stroke: #000"></line>

    <linearGradient id="leftToRight">
        <stop offset="0%" style="stop-color:blue"></stop>
        <stop offset="30%" style="stop-color:blue"></stop>
        <stop offset="30%" style="stop-color:red"></stop>
        <stop offset="100%" style="stop-color:red"></stop>
    </linearGradient>
    <linearGradient id="topToBottom" xlink:href="#leftToRight" x1="0%" y1="0%" x2="0" y2="100%"></linearGradient>
    <linearGradient id="rightToLeft" xlink:href="#leftToRight" x1="100%" y1="0%" x2="0" y2="0%"></linearGradient>
    <linearGradient id="bottomToTop" xlink:href="#leftToRight" x1="0%" y1="100%" x2="0" y2="0%"></linearGradient>
    <rect id="box" x="120" y="160" width="40" height="40" style="fill:url(#leftToRight);"></rect>
</svg>
<div id="btn">
    <div class="box">
        <p>
            <a id="go">前进</a>
        </p>
        <p>
            <a id="turnLeft">左转</a>
            <a id="turnBack">转身</a>
            <a id="turnRight">右转</a>
        </p>
    </div>
    <div class="box">
        <p>
            <a id="up">上移</a>
        </p>
        <p>
            <a id="left">左移</a>
            <a id="down">下移</a>
            <a id="right">右移</a>
        </p>
    </div>
    <div class="box">
        <p>
            <a id="moveUp">上转移</a>
        </p>
        <p>
            <a id="moveLeft">左转移</a>
            <a id="moveDown">下转移</a>
            <a id="moveRight">右转移</a>
        </p>
    </div>
</div>
<script>
    var animated = false;
    function $(id) {
        return document.getElementById(id);
    }
    var flag = Math.floor(Math.random() * 4);
    console.log(flag);

    // 随机位置以及方向
    (function randomPos() {
        var x = Math.floor(Math.random() * 10) * 40;
        var y = Math.floor(Math.random() * 10) * 40;
        $('box').setAttribute('x', x);
        $('box').setAttribute('y', y);
        changeColor(flag % 4);
    })();
    function changeColor(o){
        switch (o) {
            case 0:
                $("box").setAttribute("style", "fill:url(#leftToRight)");
                break;
            case 1:
                $("box").setAttribute("style", "fill:url(#topToBottom)");
                break;
            case 2:
                $("box").setAttribute("style", "fill:url(#rightToLeft)");
                break;
            case 3:
                $("box").setAttribute("style", "fill:url(#bottomToTop)");
                break;
            default:
                break;
        }
    }
    $('btn').onclick = function () {
        var e = arguments[0] || window.event;
        var target = e.target || e.srcElement;

        var boxPos = $("box").getBBox();
        if (animated) return; // 移动中点击不生效
        if (target.id === 'go') {
            switch (flag % 4) {
                case 0:
                    move(-40, boxPos.x, 'x');
                    break;
                case 1:
                    move(-40, boxPos.y, 'y');
                    break;
                case 2:
                    move(40, boxPos.x, 'x');
                    break;
                case 3:
                    move(40, boxPos.y, 'y');
                    break;
                default:
                    break;
            }
        }

        switch (target.id) {
                // 转向
            case 'turnRight':
                flag++;
                changeColor(flag % 4);
                break;

            case 'turnBack':
                flag += 2;
                changeColor(flag % 4);
                break;

            case 'turnLeft':
                flag += 3;
                changeColor(flag % 4);
                break;

                // 移动
            case 'up':
                move(-40, boxPos.y, 'y');
                break;
            case 'left':
                move(-40, boxPos.x, 'x');
                break;
            case 'down':
                move(40, boxPos.y, 'y');
                break;
            case 'right':
                move(40, boxPos.x, 'x');
                break;

                // 移动转向
            case 'moveUp':
                move(-40, boxPos.y, 'y');
                $("box").setAttribute("style", "fill:url(#topToBottom)");
                flag = 1;
                break;

            case 'moveLeft':
                move(-40, boxPos.x, 'x');
                $("box").setAttribute("style", "fill:url(#leftToRight)");
                flag = 0;
                break;

            case 'moveDown':
                move(40, boxPos.y, 'y');
                $("box").setAttribute("style", "fill:url(#bottomToTop)");
                flag = 3;
                break;

            case 'moveRight':
                move(40, boxPos.x, 'x');
                $("box").setAttribute("style", "fill:url(#rightToLeft)");
                flag = 2;
                break;

            default:
                break;
        }
    };

    function move(value, boxPos, xy) {
        animated = true; // 移动中点击不生效
        var time = 1000;
        var interval = 10;
        var speed = value / (time / interval);
        var newPos = boxPos + value;

        if (newPos < 0) {
            animated = false;
            $("box").setAttribute(xy, 0);
        }
        else if (newPos > 360) {
            animated = false;
            $("box").setAttribute(xy, 360);
        }
        else {
            var timer = setInterval(function() {
                if ((speed < 0 && newPos < boxPos) || (speed > 0 && newPos > boxPos)) {
                    boxPos += speed;
                    $("box").setAttribute(xy, boxPos);
                }
                else {
                    clearInterval(timer);
                    animated = false;
                    $("box").setAttribute(xy, newPos);
                }
            }, interval);
        }
    }
</script>
</body>
</html>
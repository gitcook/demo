<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>IFE JavaScript Task05</title>
    <style>
        body {
            padding: 40px;
        }
        button {
            margin-left: 15px;
            background-color: #fff;
            border-radius: 3px;
            cursor: pointer;
        }
        #main {
            display: table;
            margin: 0 auto;
        }
        #left-out {
            margin-left: 60px;
        }
        ul {
            padding: 0;
        }
        li {
            display: inline-block;
            margin-right: 3px;
            padding: 3px 5px;
            width: 6px;
            /*height: 30px;*/
            background-color: red;
            text-align: center;
            /*line-height: 30px;*/
            cursor: pointer;
        }
        p {
            color: red;
        }
    </style>
</head>
<body>
<div id="main">
    <input type="text" placeholder="请输入数字！" size=30>
    <button id="left-in">左侧入</button>
    <button id="right-in">右侧入</button>
    <button id="left-out">左侧出</button>
    <button id="right-out">右侧出</button>
    <button id="bubble-sort">排序</button>
    <ul id="num"></ul>
    <p></p>
</div>
<script type="text/javascript">
    var main = document.getElementById('main');
    var input = document.getElementsByTagName('input')[0];
    var oUl = document.getElementById('num');

    var p = document.getElementsByTagName('p')[0]; // alert提示改为显示在网页上
    input.focus();

    // 事件代理
    main.onclick = function () {
        var e = arguments[0] || window.event;
        var target = e.target || e.srcElement;
        if (target.nodeName.toLowerCase() === 'button') {
            if (target.id === 'left-in') {
                addNum(true);
            }
            if (target.id === 'right-in') {
                addNum(false);
            }
            if (target.id === 'left-out') {
                delNum(true);
            }
            if (target.id === 'right-out') {
                delNum(false);
            }
            if (target.id === 'bubble-sort') {
                bubbleSort();
            }
        }
        else if (target.nodeName.toLowerCase() === 'li') {
            oUl.removeChild(target);
        }
    };

    //冒泡排序
    function bubbleSort() {
        var oLi = oUl.getElementsByTagName('li');
        var len = oLi.length;
        var heightArr = []; // 高度集合
        for (var n = 0 ; n < len; n ++) {
            heightArr.push(oLi[n].style.height);
        }

        // 冒泡排序
        for (var i = 0; i < len - 1; i++) {
            for (var j = 0; j < len - 1 - i; j++) {
                if (heightArr[j] > heightArr[j + 1]) {
                    var temp = heightArr[j];
                    heightArr[j] = heightArr[j + 1];
                    heightArr[j + 1] = temp;
                }
            }
        }

        for (var m = 0; m < len; m++) {
            oLi[m].style.height = heightArr[m];
        }
    }

    // 判断输入是否为数字
    function isNum(data) {
        var bool = /^[\d\.]+$/.test(data);// 纯数字或小数
        if (bool) {
            return true;
        }
        else if (!data){
            // alert("输入不能为空!");
            p.innerHTML = '输入不能为空!';
            return false;
        }
        else {
            // alert("请输入纯数字!");
            p.innerHTML = '请输入纯数字!';
            return false;
        }
    }

    // 增加数字，根据switch的值判断left和right
    function addNum(positive) {
        var inputNum = input.value.replace(/\s+/g, ''); // 提前赋值会为空
        if (!isNum(inputNum)) return false; // inputNum 不是数字或者为空函数到此结束
        if (!hasNum(inputNum, oUl)) {
            // alert("数字已存在!");
            p.innerHTML = '数字已存在!';
            return false;
        }
        if (inputNum < 10 || inputNum > 100) {
            p.innerHTML = '数字必须在10-100之间!';
            return false;
        }
        if (oUl.childNodes.length > 59) {
            p.innerHTML = '元素个数不能超过60!';
            return false;
        }

        var li = document.createElement('li');
        // li.count = inputNum;
        li.style.height = inputNum + 'px';
        p.innerHTML = '';
        if (positive) {
            oUl.insertBefore(li, oUl.childNodes[0]);
        }
        else {
            oUl.appendChild(li);
        }

        input.value = '';
    }

    // 删除数字
    /**
     * 删除数字
     * @param  {boolean} positive 确定从左右删除
     * @return {[type]}          [description]
     */
    function delNum(positive) {
        if (oUl.childNodes.length) {
            p.innerHTML = '';
            if (positive) {
                oUl.removeChild(oUl.firstChild);
            }
            else {
                oUl.removeChild(oUl.lastChild);
            }
        }
    }

    // 判断数字是否存在，存在就不加入
    function hasNum(num, ele) {
        var child = ele.childNodes;
        for (var i = 0; i < child.length; i ++) {
            if (child[i].style.height === num + 'px') return false; // 存在,注意判断逻辑无法用 !==
        }
        return true; // 不存在
    }

    document.onkeydown = function(ev) {
        var event = ev || window.event;

        if (event.keyCode === 13) addNum(false);
    };
</script>
</body>
</html>